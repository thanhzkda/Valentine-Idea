<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qu√† t·∫∑ng ƒë·∫∑t bi·ªát! D√†nh cho ng∆∞·ªùi ƒë·∫∑c bi·ªát üòò‚ù§Ô∏è</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/heart-scene.css">

    <!-- Three.js + MediaPipe import map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
                "@mediapipe/tasks-vision": "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/+esm"
            }
        }
    </script>
</head>
<audio id="bg-music" loop>
    <source src="music.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>

<body>
    <!-- Game Screen -->
    <div id="game-screen" class="screen active">
        <div class="container">
            <h1 class="title">H√£y ch∆°i m·ªôt game nho nh·ªè v·ªõi Anh nha ‚ù§Ô∏è</h1>

            <div class="tic-tac-toe-board">
                <div class="cell" data-index="0"></div>
                <div class="cell" data-index="1"></div>
                <div class="cell" data-index="2"></div>
                <div class="cell" data-index="3"></div>
                <div class="cell" data-index="4"></div>
                <div class="cell" data-index="5"></div>
                <div class="cell" data-index="6"></div>
                <div class="cell" data-index="7"></div>
                <div class="cell" data-index="8"></div>
            </div>

            <button id="reset-btn" class="btn">Reset Game</button>
            <div id="game-status" class="status"></div>
        </div>
    </div>

    <!-- Transition Screen -->
    <div id="transition-screen" class="screen">
        <div class="transition-container">
            <div class="heart-animation">
                <div class="heart">‚ù§Ô∏è</div>
            </div>
            <h2 class="transition-title">Th·∫Øng r·ªìi n√®e üéâ</h2>
            <p class="transition-message">M·ªü qu√† thuiii</p>
            <button id="unlock-btn" class="btn btn-primary">Nh·∫•n ƒë·ªÉ nh·∫≠n qu√† n√® c∆∞ng, anh n√≥i thi·ªát m√† üéÅ</button>
        </div>
    </div>

    <!-- 3D Heart Scene Screen -->
    <div id="heart-screen" class="screen">
        <!-- Loading overlay -->
        <div id="heart-loader">
            <div class="spinner"></div>
            <div class="loader-text">ƒê·ª£i x√≠u nhoa, h∆°i lag lag nh·∫π</div>
        </div>

        <!-- 3D Canvas -->
        <div id="heart-canvas-container"></div>

        <!-- UI Layer -->
        <div id="heart-ui-layer">
            <h1>T√¨nh y√™u ƒë√¥i m√¨nh üíï</h1>

            <!-- Controls -->
            <div class="heart-controls">
                <div class="heart-control-btn" id="heart-cam-btn">üì∑ Enable Gesture</div>
                <div class="heart-hint-text">Touch: Drag to rotate ‚Ä¢ Click photo to view</div>
            </div>

            <!-- Mode Bar -->
            <div id="heart-mode-bar">
                <div class="heart-mode-btn" onclick="setHeartMode('HEART')" title="Heart Mode">üíï</div>
                <div class="heart-mode-btn" onclick="setHeartMode('SCATTER')" title="Scatter Mode">‚ú®</div>
                <div class="heart-mode-btn" onclick="setHeartMode('FOCUS_RANDOM')" title="Focus Mode">üîç</div>
            </div>
        </div>

        <!-- Webcam preview -->
        <div id="heart-webcam-wrapper">
            <video id="heart-webcam" autoplay playsinline webkit-playsinline></video>
        </div>
        <div id="heart-debug-info">Drag to rotate ‚Ä¢ Tap photo to view</div>
    </div>

    <!-- Fullscreen Media Viewer Overlay -->
    <div id="media-viewer-overlay">
        <div class="flying-media-container"></div>
        <div class="viewer-media-wrapper"></div>
        <button class="viewer-close-btn" onclick="closeMediaViewer()">‚úï</button>
        <div class="viewer-caption">
            <h3></h3>
            <p class="viewer-date"></p>
            <p class="viewer-desc"></p>
        </div>
    </div>

    <!-- Gallery Screen (legacy fallback, no longer reached in normal flow) -->
    <div id="gallery-screen" class="screen">
        <div class="gallery-container">
            <div id="camera-notice" class="camera-notice">
                <div class="notice-content">
                    <h3>‚ú® Enable Hand Gestures ‚ú®</h3>
                    <p>Allow camera access to control the gallery with hand gestures!</p>
                    <button id="enable-camera-btn" class="btn btn-primary">Enable Camera</button>
                    <button id="skip-camera-btn" class="btn btn-secondary">Skip (Use Keyboard)</button>
                </div>
            </div>
            <div class="gallery-header">
                <h2>Our Journey Together üíï</h2>
                <div id="gesture-indicator" class="gesture-indicator hidden">
                    <span class="indicator-dot"></span>
                    <span class="indicator-text">Gesture Active</span>
                </div>
            </div>
            <div class="media-container">
                <button class="nav-btn nav-prev" id="prev-btn">‚Äπ</button>
                <div class="media-wrapper">
                    <div id="media-display" class="media-display"></div>
                    <div class="media-caption">
                        <h3 id="media-title">Loading...</h3>
                        <p id="media-date"></p>
                        <p id="media-description"></p>
                    </div>
                </div>
                <button class="nav-btn nav-next" id="next-btn">‚Ä∫</button>
            </div>
            <div id="gesture-guide" class="gesture-guide">
                <div class="guide-content">
                    <h3>Hand Gesture Controls</h3>
                    <div class="gesture-list">
                        <div class="gesture-item">
                            <span class="gesture-icon">üëâ</span>
                            <span class="gesture-name">Swipe Right</span>
                            <span class="gesture-action">Next Photo</span>
                        </div>
                        <div class="gesture-item">
                            <span class="gesture-icon">üëà</span>
                            <span class="gesture-name">Swipe Left</span>
                            <span class="gesture-action">Previous Photo</span>
                        </div>
                        <div class="gesture-item">
                            <span class="gesture-icon">‚úä</span>
                            <span class="gesture-name">Fist/Pinch</span>
                            <span class="gesture-action">Play/Pause Video</span>
                        </div>
                        <div class="gesture-item">
                            <span class="gesture-icon">üëç</span>
                            <span class="gesture-name">Thumbs Up</span>
                            <span class="gesture-action">Show Controls</span>
                        </div>
                    </div>
                    <button id="close-guide-btn" class="btn btn-small">Got it!</button>
                </div>
            </div>
            <video id="hidden-webcam" style="display: none;"></video>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/game.js"></script>
    <script src="js/gallery.js"></script>
    <script src="js/gestures.js"></script>
    <script src="js/media-data.js"></script>
    <script src="js/main.js"></script>
    <script type="module" src="js/heart-scene.js?v=2.1"></script>
</body>

</html>